# SQL Schema design for Shot of Greed

## General Principles

Users log their drinks via Sessions. Each Session is just a series of Drinks at different times. Each Drink is made up of multiple Ingredients. This is the basic idea of the database design, and more detailed choices are explained in each section. The goal was to support a wide variety of possible queries - some examples include:

- What is my average number of standard drinks per session in the last month?
- How many grams of sugar have I had in Vodka Redbulls this week?
- What is my lifetime consumption of any kind of wine?
- Within my friend group, who has had a shaken cocktail the most recently?

## TODO

I want to be able to also support queries about BAC. For example:

- What has been my highest BAC this week?
- How long did my friends and I spend above 0.05 BAC in February?

Reasons why this is not implemented yet:

- BAC calculations are easiest on a per session basis via Widmark formula etc
- Parameters of BAC calculation can change over time due to drinking tolerance, weight etc
- I would have to store a large number of data points for BAC (unless i prune down the space of queries i want to support)

Also support for friend groups.

---

## Users/Login Tables

### Users

Stores the users of the app - pretty self-explanatory. Ther user with ID 0 is used as the public/shared user, e.g. the default drinks are stored as being 'created' by this user.

### LoginSessions

Logins are managed via tokens that are linked to a user. When a user logs in, a token with a certain expiry is generated by the API, stored in the database and sent to the user.

---

## Drinks/Ingredients

### Ingredients

Contains info about every ingredient. Ingredients are tied to a user creator so that we can make sure users can only edit/delete their own ingredients. When a user edits or deletes a drink, it is not actually edited or deleted - instead, the deleted flag is set, so this old version/deleted version is not displayed to the user any more. This is so that the old info on the ingredient can still be used for historical queries.

### Drinks

Pretty self explanatory. Uses the same deletion/edit policy as ingredients

### DrinkIngredients

Links together Drinks and Ingredients - this is because of the many-to-many relationship between ingredients and drinks. Also includes the volume of each component for a drink recipe.

### Tags

A table of tags for drinks or ingredients, things such as non-alcoholic or wine or spirit etc. Done so that I can add more tags in future if i want to.

### DrinkTags

Links drinks to their tags.

### IngredientTags

Links ingredients to their tags.

---

## Sessions

### Sessions

Each session belongs to a user and has a start time and end time (end is initially null until the session actually ends). 

### SessionDrinks

Each drink consumed during a session is stored in this table, with the additional layer of a start time and end time for the drink itself such as if it was drunk slowly. There is also a quantity field in case we need it.


